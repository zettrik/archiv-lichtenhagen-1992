<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Abuut - Foo Test</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Foo Test</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Home</a>
                    </li>
                    <li >
                        <a href="../foo/">About</a>
                    </li>
                    <li class="active">
                        <a href="./">Abuut</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../foo/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="prev" >
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#about">About</a></li>
            <li><a href="#enhancements-to-555controller">Enhancements to 555Controller:</a></li>
            <li><a href="#on-the-downside">On The Downside:</a></li>
        <li class="main "><a href="#voltage-measurements">Voltage Measurements</a></li>
        <li class="main "><a href="#power-consumption">Power Consumption</a></li>
        <li class="main "><a href="#power-supply">Power Supply</a></li>
            <li><a href="#voltage-regulator">Voltage Regulator</a></li>
            <li><a href="#battery-powered">Battery Powered</a></li>
            <li><a href="#li-ion-battery">Li-ion Battery</a></li>
            <li><a href="#low-voltage-disconnect">low voltage disconnect</a></li>
        <li class="main "><a href="#wifi">Wifi</a></li>
            <li><a href="#mqtt">MQTT</a></li>
        <li class="main "><a href="#circuit">Circuit</a></li>
            <li><a href="#fritzing-parts">Fritzing Parts</a></li>
            <li><a href="#pcb">PCB</a></li>
        <li class="main "><a href="#links">Links</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="about">About</h1>
<p>This is a proof of concept for a sophisticated charge controller based on
<a href="https://github.com/nodemcu">NodeMCU</a>. The idea derived from the wonderful
simple and rock solid <a href="http://mdpub.com/555Controller/">555Controller</a>.
A lot of precautions and hints were also taken from 
<a href="https://www.re-innovation.co.uk/blog/2011/open-design-charge-regulator-project/">Open Design Charge Regulator Project</a>.
The NodeMCU is a development board for an ESP8266 chip. It integrates a 3.3V regulator and USB communication.</p>
<h2 id="enhancements-to-555controller">Enhancements to 555Controller:</h2>
<ul>
<li>measuring wind speed and blade rotation</li>
<li>data logging to sd-card</li>
<li>wireless control and monitoring of the internal state</li>
</ul>
<h2 id="on-the-downside">On The Downside:</h2>
<ul>
<li>way more power consumption for the controller itself</li>
<li>more complex setup</li>
</ul>
<h1 id="voltage-measurements">Voltage Measurements</h1>
<ul>
<li>https://www.re-innovation.co.uk/docs/accurate-voltage-measurment/</li>
<li>https://www.re-innovation.co.uk/docs/dc-current-measurement/</li>
</ul>
<h1 id="power-consumption">Power Consumption</h1>
<ul>
<li>NodeMCU 95mA @ 3.3V with active wifi</li>
<li>NodeMCU 38mA @ 3.3V without wifi</li>
<li>SD-Card Adapter 20mA @ 3.3V</li>
<li>MCP3208 0,5mA @ 3.3V</li>
<li>RTC ?</li>
</ul>
<h1 id="power-supply">Power Supply</h1>
<p>How to power the NodeMCU</p>
<h2 id="voltage-regulator">Voltage Regulator</h2>
<p>In case the voltage regulator (AMS1117) doesn't fit your needs or was damaged
you may replace it with:
<em> LP2951 3.3V
</em> MCP1700
<em> L78L33 (max. 100mA which is probably not enough)
</em> https://www.tindie.com/products/nEXT_EVO1/30v-synchronous-step-down-dc-dc-converter/</p>
<h2 id="battery-powered">Battery Powered</h2>
<ul>
<li>car battery: Pololu 3.3V Low-Voltage Cutoff S9V11F3S5C3 (up to 16V) </li>
<li>http://pic-microcontroller.com/running-nodemcu-on-a-battery/</li>
<li>http://www.instructables.com/id/ESP8266-Li-Ion-Battery-rechargeable-battery-power-/</li>
<li>http://blog.itechica.com/?p=92 -- power usage in deepsleep (in German)</li>
<li>no serial connection</li>
<li>delay(100)</li>
<li>pull down resistance on GPIO0 ?</li>
</ul>
<h2 id="li-ion-battery">Li-ion Battery</h2>
<ul>
<li>li-ion: Pololu Adjustable Step-Up/Step-Down Voltage Regulator S7V8A (2,7 - 11,8V)</li>
<li>You could also try to run it directly from a 3.7V li-ion battery without a voltage regulator but with a small voltage dropping diode as described here. It worked in my tests with a 18650 battery but might be dangerous in long term:</li>
<li>https://tinker.yeoman.com.au/2016/05/29/running-nodemcu-on-a-battery-esp8266-low-power-consumption-revisited/</li>
</ul>
<h2 id="low-voltage-disconnect">low voltage disconnect</h2>
<ul>
<li>http://homecircuits.eu/blog/program-attiny13a-via-arduino-board/</li>
<li>http://homecircuits.eu/blog/low-power-picopower-attiny13a/</li>
<li>http://homecircuits.eu/blog/arduino-low-voltage-disconnect-circuit/</li>
</ul>
<h1 id="wifi">Wifi</h1>
<p>Monitoring of the charge controller is possible via wifi. Status
messages are regulary send to an mqttbroker.</p>
<h2 id="mqtt">MQTT</h2>
<ul>
<li>https://github.com/knolleary/pubsubclient -- arduino/esp8266 MQTT client</li>
<li>to send data in json format you probably want to increase the max mqtt packet size. adapt to your needs in PubSubClient.h: #define MQTT_MAX_PACKET_SIZE 1024</li>
<li>https://pypi.python.org/pypi/paho-mqtt</li>
<li>https://mosquitto.org/ -- lightweight MQTT broker (e.g. for wifi access points)</li>
<li>on openwrt/lede: opkg update; opkg install mosquitto-nossl</li>
<li>on debian: apt-get install mosquitto</li>
<li>listens by default on port 1883</li>
<li>read mqtt channel on local mqtt broker:</li>
<li>aptitude install mosquitto-clients</li>
<li>mosquitto_sub -d -h broker -t "node/1/power"  # one channel</li>
<li>mosquitto_sub -d -h localhost -t "node/#" # all subchannels</li>
</ul>
<h1 id="circuit">Circuit</h1>
<ul>
<li>https://forum.mysensors.org/topic/6724/solved-nodemcu-esp8266-and-spi-with-nrf24l01-sd-card-module-sanity-errors/3</li>
<li>http://www.electronicwings.com/nodemcu/nodemcu-i2c-with-arduino-ide</li>
</ul>
<h2 id="fritzing-parts">Fritzing Parts</h2>
<ul>
<li>https://github.com/squix78/esp8266-fritzing-parts -- NodeMCU</li>
<li>https://github.com/adafruit/Fritzing-Library/tree/master/parts -- MCP3008</li>
<li><a href="../mcp3208/MCP3208_8-channel_12-bit_ADC.fzpz">MCP3208 8 channel 12-Bit ADC</a> -- MCP3208</li>
</ul>
<h2 id="pcb">PCB</h2>
<ul>
<li>http://bwir.de/pcb-platinen-mit-haushaltsmitteln-guenstig-selber-herstellen/ -- self made pcbs</li>
</ul>
<h1 id="links">Links</h1>
<ul>
<li>https://frightanic.com/iot/tools-ides-nodemcu/ -- comparison of development tools</li>
<li>https://github.com/lvidarte/esp8266/wiki -- good starting point as a NodeMCU workshop</li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script src="../js/base.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
